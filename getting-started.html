<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Getting Started - The Swanling Book</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="HTTP Load testing framework. Inspired by Locust and Drill. Implemented with Rust.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
                <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="overview.html">Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">Swanling</li><li class="chapter-item expanded "><a href="getting-started.html" class="active"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="simple-example.html"><strong aria-hidden="true">2.</strong> Simple Example</a></li><li class="chapter-item expanded "><a href="scheduling-swanling-task-sets.html"><strong aria-hidden="true">3.</strong> Scheduling Swanling Task Sets</a></li><li class="chapter-item expanded "><a href="defaults.html"><strong aria-hidden="true">4.</strong> Defaults</a></li><li class="chapter-item expanded "><a href="controlling-running-swanling-load-test.html"><strong aria-hidden="true">5.</strong> Controlling Running Swanling Load Test</a></li><li class="chapter-item expanded "><a href="throttling-requests.html"><strong aria-hidden="true">6.</strong> Throttling Requests</a></li><li class="chapter-item expanded "><a href="logging-load-test-errors.html"><strong aria-hidden="true">7.</strong> Logging Load Test Errors</a></li><li class="chapter-item expanded "><a href="logging-load-test-requests.html"><strong aria-hidden="true">8.</strong> Logging Load Test Requests</a></li><li class="chapter-item expanded "><a href="logging-load-test-tasks.html"><strong aria-hidden="true">9.</strong> Logging Load Test Tasks</a></li><li class="chapter-item expanded "><a href="load-test-debug-logging.html"><strong aria-hidden="true">10.</strong> Load Test Debug Logging</a></li><li class="chapter-item expanded "><a href="coordinated-omission-mitigation.html"><strong aria-hidden="true">11.</strong> Coordinated Omission Mitigation</a></li><li class="chapter-item expanded affix "><li class="part-title">Regatta</li><li class="chapter-item expanded "><a href="distributed-load-test.html"><strong aria-hidden="true">12.</strong> Distributed Load Test</a></li><li class="chapter-item expanded "><a href="rustls.html"><strong aria-hidden="true">13.</strong> RustLS</a></li><li class="chapter-item expanded affix "><li class="part-title">Developers</li><li class="chapter-item expanded "><a href="developers.html"><strong aria-hidden="true">14.</strong> Developers</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="contributors.html">Contributors</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">The Swanling Book</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<p>The <a href="https://docs.rs/swanling/*/swanling/#creating-a-simple-swanling-load-test">in-line documentation</a> offers much more detail about Swanling specifics. For a general background to help you get started with Rust and Swanling, read on.</p>
<p><a href="https://doc.rust-lang.org/cargo/">Cargo</a> is the Rust package manager. To create a new load test, use Cargo to create a new application (you can name your application anything, we've generically selected <code>loadtest</code>):</p>
<pre><code class="language-bash">$ cargo new loadtest
     Created binary (application) `loadtest` package
$ cd loadtest/
</code></pre>
<p>This creates a new directory named <code>loadtest/</code> containing <code>loadtest/Cargo.toml</code> and <code>loadtest/src/main.rs</code>. Start by editing <code>Cargo.toml</code> adding Swanling under the dependencies heading:</p>
<pre><code class="language-toml">[dependencies]
swanling = &quot;^0.12&quot;
</code></pre>
<p>At this point it's possible to compile all dependencies, though the resulting binary only displays &quot;Hello, world!&quot;:</p>
<pre><code>$ cargo run
    Updating crates.io index
  Downloaded swanling v0.12.0
      ...
   Compiling swanling v0.12.0
   Compiling loadtest v0.1.0 (/home/jandrews/devel/rust/loadtest)
    Finished dev [unoptimized + debuginfo] target(s) in 52.97s
     Running `target/debug/loadtest`
Hello, world!
</code></pre>
<p>To create an actual load test, you first have to add the following boilerplate to the top of <code>src/main.rs</code> to make Swanling's functionality available to your code:</p>
<pre><pre class="playground"><code class="language-rust edition2018">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use swanling::prelude::*;
<span class="boring">}
</span></code></pre></pre>
<p>Then create a new load testing function. For our example we're simply going to load the front page of the website we're load-testing. Swanling passes all load testing functions a pointer to a SwanlingUser object, which is used to track metrics and make web requests. Thanks to the Reqwest library, the Swanling client manages things like cookies, headers, and sessions for you. Load testing functions must be declared async, which helps ensure that your simulated users don't become CPU-locked.</p>
<p>In load test functions you typically do not set the host, and instead configure the host at run time, so you can easily run your load test against different environments without recompiling. The following <code>loadtest_index</code> function simply loads the front page of our web page:</p>
<pre><pre class="playground"><code class="language-rust edition2018">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>async fn loadtest_index(user: &amp;SwanlingUser) -&gt; SwanlingTaskResult {
    let _swanling_metrics = user.get(&quot;/&quot;).await?;

    Ok(())
}
<span class="boring">}
</span></code></pre></pre>
<p>The function is declared <code>async</code> so that we don't block a CPU-core while loading web pages. All Swanling load test functions are passed in a reference to a <code>SwanlingUser</code> object, and return a <code>SwanlingTaskResult</code> which is either an empty <code>Ok(())</code> on success, or a <code>SwanlingTaskError</code> on failure. We use the <code>SwanlingUser</code> object to make requests, in this case we make a <code>GET</code> request for the front page, <code>/</code>. The <code>.await</code> frees up the CPU-core while we wait for the web page to respond, and the tailing <code>?</code> passes up any unexpected errors that may be returned from this request. When the request completes, Swanling returns metrics which we store in the  <code>_swanling_metrics</code> variable. The variable is prefixed with an underscore (<code>_</code>) to tell the compiler we are intentionally not using the results. Finally, after making a single successful request, we return <code>Ok(())</code> to let Swanling know this task function completed successfully.</p>
<p>We have to tell Swanling about our new task function. Edit the <code>main()</code> function, setting a return type and replacing the hello world text as follows:</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn main() -&gt; Result&lt;(), SwanlingError&gt; {
    SwanlingAttack::initialize()?
        .register_taskset(taskset!(&quot;LoadtestTasks&quot;)
            .register_task(task!(loadtest_index))
        )
        .execute()?
        .print();

    Ok(())
}
</code></pre></pre>
<p>If you're new to Rust, <code>main()</code>'s return type of <code>Result&lt;(), SwanlingError&gt;</code> may look strange. It essentially says that <code>main</code> will return nothing (<code>()</code>) on success, and will return a <code>SwanlingError</code> on failure. This is helpful as several of <code>SwanlingAttack</code>'s methods can fail, returning an error. In our example, <code>initialize()</code> and <code>execute()</code> each may fail. The <code>?</code> that follows the method's name tells our program to exit and return an error on failure, otherwise continue on. The <code>print()</code> method consumes the <code>SwanlingMetrics</code> object returned by <code>SwanlingAttack.execute()</code> and prints a summary if metrics are enabled. The final line, <code>Ok(())</code> returns the empty result expected on success.</p>
<p>And that's it, you've created your first load test! Let's run it and see what happens.</p>
<pre><code class="language-bash">$ cargo run
   Compiling loadtest v0.1.0 (/home/jandrews/devel/rust/loadtest)
    Finished dev [unoptimized + debuginfo] target(s) in 3.56s
     Running `target/debug/loadtest`
Error: InvalidOption { option: &quot;--host&quot;, value: &quot;&quot;, detail: &quot;A host must be defined via the --host option, the SwanlingAttack.set_default() function, or the SwanlingTaskSet.set_host() function (no host defined for LoadtestTasks).&quot; }
</code></pre>
<p>Swanling is unable to run, as it hasn't been told the host you want to load test. So, let's try again, this time passing in the <code>--host</code> flag. After running for a few seconds, we then press <code>ctrl-c</code> to stop the load test:</p>
<pre><code class="language-bash">$ cargo run -- --host http://local.dev/
    Finished dev [unoptimized + debuginfo] target(s) in 0.07s
     Running `target/debug/loadtest --host 'http://local.dev/'`

=== PER TASK METRICS ===
------------------------------------------------------------------------------
 Name                    | # times run    | # fails        | task/s | fail/s
 -----------------------------------------------------------------------------
 1: LoadtestTasks        |
   1:                    | 2,240          | 0 (0%)         | 280.0  | 0.000
-------------------------------------------------------------------------------
 Name                    | Avg (ms)   | Min        | Max        | Median
 -----------------------------------------------------------------------------
 1: LoadtestTasks        |
   1:                    | 15.54      | 6          | 136        | 14

=== PER REQUEST METRICS ===
------------------------------------------------------------------------------
 Name                    | # reqs         | # fails        | req/s  | fail/s
 -----------------------------------------------------------------------------
 GET /                   | 2,240          | 0 (0%)         | 280.0  | 0.000
-------------------------------------------------------------------------------
 Name                    | Avg (ms)   | Min        | Max        | Median
 -----------------------------------------------------------------------------
 GET /                   | 15.30      | 6          | 135        | 14

All 8 users hatched, resetting metrics (disable with --no-reset-metrics).

^C06:03:25 [ WARN] caught ctrl-c, stopping...

=== PER TASK METRICS ===
------------------------------------------------------------------------------
 Name                    | # times run    | # fails        | task/s | fail/s
 -----------------------------------------------------------------------------
 1: LoadtestTasks        |
   1:                    | 2,054          | 0 (0%)         | 410.8  | 0.000
-------------------------------------------------------------------------------
 Name                    | Avg (ms)   | Min        | Max        | Median
 -----------------------------------------------------------------------------
 1: LoadtestTasks        |
   1:                    | 20.86      | 7          | 254        | 19

=== PER REQUEST METRICS ===
------------------------------------------------------------------------------
 Name                    | # reqs         | # fails        | req/s  | fail/s
 -----------------------------------------------------------------------------
 GET /                   | 2,054          | 0 (0%)         | 410.8  | 0.000
-------------------------------------------------------------------------------
 Name                    | Avg (ms)   | Min        | Max        | Median
 -----------------------------------------------------------------------------
 GET /                   | 20.68      | 7          | 254        | 19
-------------------------------------------------------------------------------
 Slowest page load within specified percentile of requests (in ms):
 ------------------------------------------------------------------------------
 Name                    | 50%    | 75%    | 98%    | 99%    | 99.9%  | 99.99%
 -----------------------------------------------------------------------------
 GET /                   | 19     | 21     | 53     | 69     | 250    | 250
</code></pre>
<p>By default, Swanling will hatch 1 SwanlingUser per second, up to the number of CPU cores available on the server used for load testing. In the above example, the server has 8 CPU cores, so it took 8 seconds to hatch all users. After all users are hatched, Swanling flushes all metrics collected during the hatching process so all subsequent metrics are taken with all users running. Before flushing the metrics, they are displayed to the console so the data is not lost.</p>
<p>The same metrics are displayed per-task and per-request. In our simple example, our single task only makes one request, so in this case both metrics show the same results.</p>
<p>The per-task metrics are displayed first, starting with the name of our Task Set, <code>LoadtestTasks</code>. Individual tasks in the Task Set are then listed in the order they are defined in our load test. We did not name our task, so it simply shows up as <code>1: </code>. All defined tasks will be listed here, even if they did not run, so this can be useful to confirm everything in your load test is running as expected.</p>
<p>Next comes the per-request metrics. Our single task makes a <code>GET</code> request for the <code>/</code> path, so it shows up in the metrics as <code>GET /</code>. Comparing the per-task metrics collected for <code>1: </code> to the per-request metrics collected for <code>GET /</code>, you can see that they are the same.</p>
<p>There are two common tables found in each type of metrics. The first shows the total number of requests made (2,054), how many of those failed (0), the average number of requests per second (410.8), and the average number of failed requests per second (0).</p>
<p>The second table shows the average time required to load a page (20.68 milliseconds), the minimum time to load a page (7 ms), the maximum time to load a page (254 ms) and the median time to load a page (19 ms).</p>
<p>The per-request metrics include a third table, showing the slowest page load time for a range of percentiles. In our example, in the 50% fastest page loads, the slowest page loaded in 19 ms. In the 75% fastest page loads, the slowest page loaded in 21 ms, etc.</p>
<p>In real load tests, you'll most likely have multiple task sets each with multiple tasks, and Swanling will show you metrics for each along with an aggregate of them all together.</p>
<p>Refer to the <a href="https://github.com/begleybrothers/swanling/tree/master/examples">examples directory</a> for more complicated and useful load test examples.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="overview.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="simple-example.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="overview.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="simple-example.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
