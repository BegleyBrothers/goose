<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Swanling Book</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="HTTP Load testing framework. Inspired by Locust and Drill. Implemented with Rust.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
                <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="overview.html">Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">Swanling</li><li class="chapter-item expanded "><a href="getting-started.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="simple-example.html"><strong aria-hidden="true">2.</strong> Simple Example</a></li><li class="chapter-item expanded "><a href="scheduling-swanling-task-sets.html"><strong aria-hidden="true">3.</strong> Scheduling Swanling Task Sets</a></li><li class="chapter-item expanded "><a href="defaults.html"><strong aria-hidden="true">4.</strong> Defaults</a></li><li class="chapter-item expanded "><a href="controlling-running-swanling-load-test.html"><strong aria-hidden="true">5.</strong> Controlling Running Swanling Load Test</a></li><li class="chapter-item expanded "><a href="throttling-requests.html"><strong aria-hidden="true">6.</strong> Throttling Requests</a></li><li class="chapter-item expanded "><a href="logging-load-test-errors.html"><strong aria-hidden="true">7.</strong> Logging Load Test Errors</a></li><li class="chapter-item expanded "><a href="logging-load-test-requests.html"><strong aria-hidden="true">8.</strong> Logging Load Test Requests</a></li><li class="chapter-item expanded "><a href="logging-load-test-tasks.html"><strong aria-hidden="true">9.</strong> Logging Load Test Tasks</a></li><li class="chapter-item expanded "><a href="load-test-debug-logging.html"><strong aria-hidden="true">10.</strong> Load Test Debug Logging</a></li><li class="chapter-item expanded "><a href="coordinated-omission-mitigation.html"><strong aria-hidden="true">11.</strong> Coordinated Omission Mitigation</a></li><li class="chapter-item expanded affix "><li class="part-title">Regatta</li><li class="chapter-item expanded "><a href="distributed-load-test.html"><strong aria-hidden="true">12.</strong> Distributed Load Test</a></li><li class="chapter-item expanded "><a href="rustls.html"><strong aria-hidden="true">13.</strong> RustLS</a></li><li class="chapter-item expanded affix "><li class="part-title">Developers</li><li class="chapter-item expanded "><a href="developers.html"><strong aria-hidden="true">14.</strong> Developers</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="contributors.html">Contributors</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">The Swanling Book</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<p>Swanling is a Rust load testing tool inspired by <a href="https://locust.io/">Locust</a>. User behavior is defined with standard Rust code. Load tests are applications that have a dependency on the Swanling library. Web requests are made with the <a href="https://docs.rs/reqwest">Reqwest</a> HTTP Client.</p>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<p>Minimum required <code>rustc</code> version is <code>1.49.0</code>: <code>swanling</code> depends on <a href="https://docs.rs/flume"><code>flume</code></a> for communication between threads, which in turn depends on <a href="https://docs.rs/spinning_top"><code>spinning_top</code></a> which uses <code>hint::spin_loop</code> which stabilized in <code>rustc</code> version <code>1.49.0</code>. More detail in https://github.com/rust-lang/rust/issues/55002.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<p>The <a href="https://docs.rs/swanling/*/swanling/#creating-a-simple-swanling-load-test">in-line documentation</a> offers much more detail about Swanling specifics. For a general background to help you get started with Rust and Swanling, read on.</p>
<p><a href="https://doc.rust-lang.org/cargo/">Cargo</a> is the Rust package manager. To create a new load test, use Cargo to create a new application (you can name your application anything, we've generically selected <code>loadtest</code>):</p>
<pre><code class="language-bash">$ cargo new loadtest
     Created binary (application) `loadtest` package
$ cd loadtest/
</code></pre>
<p>This creates a new directory named <code>loadtest/</code> containing <code>loadtest/Cargo.toml</code> and <code>loadtest/src/main.rs</code>. Start by editing <code>Cargo.toml</code> adding Swanling under the dependencies heading:</p>
<pre><code class="language-toml">[dependencies]
swanling = &quot;^0.12&quot;
</code></pre>
<p>At this point it's possible to compile all dependencies, though the resulting binary only displays &quot;Hello, world!&quot;:</p>
<pre><code>$ cargo run
    Updating crates.io index
  Downloaded swanling v0.12.0
      ...
   Compiling swanling v0.12.0
   Compiling loadtest v0.1.0 (/home/jandrews/devel/rust/loadtest)
    Finished dev [unoptimized + debuginfo] target(s) in 52.97s
     Running `target/debug/loadtest`
Hello, world!
</code></pre>
<p>To create an actual load test, you first have to add the following boilerplate to the top of <code>src/main.rs</code> to make Swanling's functionality available to your code:</p>
<pre><pre class="playground"><code class="language-rust edition2018">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use swanling::prelude::*;
<span class="boring">}
</span></code></pre></pre>
<p>Then create a new load testing function. For our example we're simply going to load the front page of the website we're load-testing. Swanling passes all load testing functions a pointer to a SwanlingUser object, which is used to track metrics and make web requests. Thanks to the Reqwest library, the Swanling client manages things like cookies, headers, and sessions for you. Load testing functions must be declared async, which helps ensure that your simulated users don't become CPU-locked.</p>
<p>In load test functions you typically do not set the host, and instead configure the host at run time, so you can easily run your load test against different environments without recompiling. The following <code>loadtest_index</code> function simply loads the front page of our web page:</p>
<pre><pre class="playground"><code class="language-rust edition2018">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>async fn loadtest_index(user: &amp;SwanlingUser) -&gt; SwanlingTaskResult {
    let _swanling_metrics = user.get(&quot;/&quot;).await?;

    Ok(())
}
<span class="boring">}
</span></code></pre></pre>
<p>The function is declared <code>async</code> so that we don't block a CPU-core while loading web pages. All Swanling load test functions are passed in a reference to a <code>SwanlingUser</code> object, and return a <code>SwanlingTaskResult</code> which is either an empty <code>Ok(())</code> on success, or a <code>SwanlingTaskError</code> on failure. We use the <code>SwanlingUser</code> object to make requests, in this case we make a <code>GET</code> request for the front page, <code>/</code>. The <code>.await</code> frees up the CPU-core while we wait for the web page to respond, and the tailing <code>?</code> passes up any unexpected errors that may be returned from this request. When the request completes, Swanling returns metrics which we store in the  <code>_swanling_metrics</code> variable. The variable is prefixed with an underscore (<code>_</code>) to tell the compiler we are intentionally not using the results. Finally, after making a single successful request, we return <code>Ok(())</code> to let Swanling know this task function completed successfully.</p>
<p>We have to tell Swanling about our new task function. Edit the <code>main()</code> function, setting a return type and replacing the hello world text as follows:</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn main() -&gt; Result&lt;(), SwanlingError&gt; {
    SwanlingAttack::initialize()?
        .register_taskset(taskset!(&quot;LoadtestTasks&quot;)
            .register_task(task!(loadtest_index))
        )
        .execute()?
        .print();

    Ok(())
}
</code></pre></pre>
<p>If you're new to Rust, <code>main()</code>'s return type of <code>Result&lt;(), SwanlingError&gt;</code> may look strange. It essentially says that <code>main</code> will return nothing (<code>()</code>) on success, and will return a <code>SwanlingError</code> on failure. This is helpful as several of <code>SwanlingAttack</code>'s methods can fail, returning an error. In our example, <code>initialize()</code> and <code>execute()</code> each may fail. The <code>?</code> that follows the method's name tells our program to exit and return an error on failure, otherwise continue on. The <code>print()</code> method consumes the <code>SwanlingMetrics</code> object returned by <code>SwanlingAttack.execute()</code> and prints a summary if metrics are enabled. The final line, <code>Ok(())</code> returns the empty result expected on success.</p>
<p>And that's it, you've created your first load test! Let's run it and see what happens.</p>
<pre><code class="language-bash">$ cargo run
   Compiling loadtest v0.1.0 (/home/jandrews/devel/rust/loadtest)
    Finished dev [unoptimized + debuginfo] target(s) in 3.56s
     Running `target/debug/loadtest`
Error: InvalidOption { option: &quot;--host&quot;, value: &quot;&quot;, detail: &quot;A host must be defined via the --host option, the SwanlingAttack.set_default() function, or the SwanlingTaskSet.set_host() function (no host defined for LoadtestTasks).&quot; }
</code></pre>
<p>Swanling is unable to run, as it hasn't been told the host you want to load test. So, let's try again, this time passing in the <code>--host</code> flag. After running for a few seconds, we then press <code>ctrl-c</code> to stop the load test:</p>
<pre><code class="language-bash">$ cargo run -- --host http://local.dev/
    Finished dev [unoptimized + debuginfo] target(s) in 0.07s
     Running `target/debug/loadtest --host 'http://local.dev/'`

=== PER TASK METRICS ===
------------------------------------------------------------------------------
 Name                    | # times run    | # fails        | task/s | fail/s
 -----------------------------------------------------------------------------
 1: LoadtestTasks        |
   1:                    | 2,240          | 0 (0%)         | 280.0  | 0.000
-------------------------------------------------------------------------------
 Name                    | Avg (ms)   | Min        | Max        | Median
 -----------------------------------------------------------------------------
 1: LoadtestTasks        |
   1:                    | 15.54      | 6          | 136        | 14

=== PER REQUEST METRICS ===
------------------------------------------------------------------------------
 Name                    | # reqs         | # fails        | req/s  | fail/s
 -----------------------------------------------------------------------------
 GET /                   | 2,240          | 0 (0%)         | 280.0  | 0.000
-------------------------------------------------------------------------------
 Name                    | Avg (ms)   | Min        | Max        | Median
 -----------------------------------------------------------------------------
 GET /                   | 15.30      | 6          | 135        | 14

All 8 users hatched, resetting metrics (disable with --no-reset-metrics).

^C06:03:25 [ WARN] caught ctrl-c, stopping...

=== PER TASK METRICS ===
------------------------------------------------------------------------------
 Name                    | # times run    | # fails        | task/s | fail/s
 -----------------------------------------------------------------------------
 1: LoadtestTasks        |
   1:                    | 2,054          | 0 (0%)         | 410.8  | 0.000
-------------------------------------------------------------------------------
 Name                    | Avg (ms)   | Min        | Max        | Median
 -----------------------------------------------------------------------------
 1: LoadtestTasks        |
   1:                    | 20.86      | 7          | 254        | 19

=== PER REQUEST METRICS ===
------------------------------------------------------------------------------
 Name                    | # reqs         | # fails        | req/s  | fail/s
 -----------------------------------------------------------------------------
 GET /                   | 2,054          | 0 (0%)         | 410.8  | 0.000
-------------------------------------------------------------------------------
 Name                    | Avg (ms)   | Min        | Max        | Median
 -----------------------------------------------------------------------------
 GET /                   | 20.68      | 7          | 254        | 19
-------------------------------------------------------------------------------
 Slowest page load within specified percentile of requests (in ms):
 ------------------------------------------------------------------------------
 Name                    | 50%    | 75%    | 98%    | 99%    | 99.9%  | 99.99%
 -----------------------------------------------------------------------------
 GET /                   | 19     | 21     | 53     | 69     | 250    | 250
</code></pre>
<p>By default, Swanling will hatch 1 SwanlingUser per second, up to the number of CPU cores available on the server used for load testing. In the above example, the server has 8 CPU cores, so it took 8 seconds to hatch all users. After all users are hatched, Swanling flushes all metrics collected during the hatching process so all subsequent metrics are taken with all users running. Before flushing the metrics, they are displayed to the console so the data is not lost.</p>
<p>The same metrics are displayed per-task and per-request. In our simple example, our single task only makes one request, so in this case both metrics show the same results.</p>
<p>The per-task metrics are displayed first, starting with the name of our Task Set, <code>LoadtestTasks</code>. Individual tasks in the Task Set are then listed in the order they are defined in our load test. We did not name our task, so it simply shows up as <code>1: </code>. All defined tasks will be listed here, even if they did not run, so this can be useful to confirm everything in your load test is running as expected.</p>
<p>Next comes the per-request metrics. Our single task makes a <code>GET</code> request for the <code>/</code> path, so it shows up in the metrics as <code>GET /</code>. Comparing the per-task metrics collected for <code>1: </code> to the per-request metrics collected for <code>GET /</code>, you can see that they are the same.</p>
<p>There are two common tables found in each type of metrics. The first shows the total number of requests made (2,054), how many of those failed (0), the average number of requests per second (410.8), and the average number of failed requests per second (0).</p>
<p>The second table shows the average time required to load a page (20.68 milliseconds), the minimum time to load a page (7 ms), the maximum time to load a page (254 ms) and the median time to load a page (19 ms).</p>
<p>The per-request metrics include a third table, showing the slowest page load time for a range of percentiles. In our example, in the 50% fastest page loads, the slowest page loaded in 19 ms. In the 75% fastest page loads, the slowest page loaded in 21 ms, etc.</p>
<p>In real load tests, you'll most likely have multiple task sets each with multiple tasks, and Swanling will show you metrics for each along with an aggregate of them all together.</p>
<p>Refer to the <a href="https://github.com/begleybrothers/swanling/tree/master/examples">examples directory</a> for more complicated and useful load test examples.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="simple-example"><a class="header" href="#simple-example">Simple Example</a></h1>
<p>The <code>-h</code> flag will show all run-time configuration options available to Swanling load tests. For example, you can pass the <code>-h</code> flag to the <code>simple</code> example as follows, <code>cargo run --example simple -- -h</code>:</p>
<pre><code>Usage: target/debug/examples/simple [OPTIONS]

Options available when launching a Swanling load test.


Optional arguments:
  -h, --help                 Displays this help
  -V, --version              Prints version information
  -l, --list                 Lists all tasks and exits

  -H, --host HOST            Defines host to load test (ie http://10.21.32.33)
  -u, --users USERS          Sets concurrent users (default: number of CPUs)
  -r, --hatch-rate RATE      Sets per-second user hatch rate (default: 1)
  -t, --run-time TIME        Stops after (30s, 20m, 3h, 1h30m, etc)
  -G, --swanling-log NAME       Enables Swanling log file and sets name
  -g, --log-level            Sets Swanling log level (-g, -gg, etc)
  -v, --verbose              Sets Swanling verbosity (-v, -vv, etc)

Metrics:
  --running-metrics TIME     How often to optionally print running metrics
  --no-reset-metrics         Doesn't reset metrics after all users have started
  --no-metrics               Doesn't track metrics
  --no-task-metrics          Doesn't track task metrics
  --no-error-summary         Doesn't display an error summary
  --report-file NAME         Create an html-formatted report
  -R, --request-log NAME     Sets request log file name
  --request-format FORMAT    Sets request log format (csv, json, raw)
  -T, --task-log NAME        Sets task log file name
  --task-format FORMAT       Sets task log format (csv, json, raw)
  -E, --error-log NAME       Sets error log file name
  --error-format FORMAT      Sets error log format (csv, json, raw)
  -D, --debug-log NAME       Sets debug log file name
  --debug-format FORMAT      Sets debug log format (csv, json, raw)
  --no-debug-body            Do not include the response body in the debug log
  --status-codes             Tracks additional status code metrics

Advanced:
  --no-telnet                Doesn't enable telnet Controller
  --telnet-host HOST         Sets telnet Controller host (default: 0.0.0.0)
  --telnet-port PORT         Sets telnet Controller TCP port (default: 5116)
  --no-websocket             Doesn't enable WebSocket Controller
  --websocket-host HOST      Sets WebSocket Controller host (default: 0.0.0.0)
  --websocket-port PORT      Sets WebSocket Controller TCP port (default: 5117)
  --no-autostart             Doesn't automatically start load test
  --co-mitigation STRATEGY   Sets coordinated omission mitigation strategy
  --throttle-requests VALUE  Sets maximum requests per second
  --sticky-follow            Follows base_url redirect with subsequent requests

Regatta:
  --manager                  Enables distributed load test Manager mode
  --expect-workers VALUE     Sets number of Workers to expect
  --no-hash-check            Tells Manager to ignore load test checksum
  --manager-bind-host HOST   Sets host Manager listens on (default: 0.0.0.0)
  --manager-bind-port PORT   Sets port Manager listens on (default: 5115)
  --worker                   Enables distributed load test Worker mode
  --manager-host HOST        Sets host Worker connects to (default: 127.0.0.1)
  --manager-port PORT        Sets port Worker connects to (default: 5115)
</code></pre>
<p>The <code>examples/simple.rs</code> example copies the simple load test documented on the locust.io web page, rewritten in Rust for Swanling. It uses minimal advanced functionality, but demonstrates how to GET and POST pages. It defines a single Task Set which has the user log in and then load a couple of pages.</p>
<p>Swanling can make use of all available CPU cores. By default, it will launch 1 user per core, and it can be configured to launch many more. The following was configured instead to launch 1,024 users. Each user randomly pauses 5 to 15 seconds after each task is loaded, so it's possible to spin up a large number of users. Here is a snapshot of <code>top</code> when running this example on a 1-core VM with 10G of available RAM -- there were ample resources to launch considerably more &quot;users&quot;, though <code>ulimit</code> had to be resized:</p>
<pre><code>top - 06:56:06 up 15 days,  3:13,  2 users,  load average: 0.22, 0.10, 0.04
Tasks: 116 total,   3 running, 113 sleeping,   0 stopped,   0 zombie
%Cpu(s):  1.7 us,  0.7 sy,  0.0 ni, 96.7 id,  0.0 wa,  0.0 hi,  1.0 si,  0.0 st
MiB Mem :   9994.9 total,   7836.8 free,   1101.2 used,   1056.9 buff/cache
MiB Swap:  10237.0 total,  10237.0 free,      0.0 used.   8606.9 avail Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
 1339 swanling     20   0 1235480 758292   8984 R   3.0   7.4   0:06.56 simple
</code></pre>
<p>Here's the output of running the loadtest. The <code>-v</code> flag sends <code>INFO</code> and more critical messages to stdout (in addition to the log file). The <code>-u1024</code> tells Swanling to spin up 1,024 users. The <code>-r32</code> option tells Swanling to hatch 32 users per second. The <code>-t10m</code> option tells Swanling to run the load test for 10 minutes, or 600 seconds. The <code>--status-codes</code> flag tells Swanling to track metrics about HTTP status codes returned by the server, in addition to the default per-task and per-request metrics. The <code>--no-reset-metrics</code> flag tells Swanling to start tracking the 10m run-time from when the first user starts, instead of the default which is to flush all metrics and start timing after all users have started. And finally, the <code>--only-summary</code> flag tells Swanling to only display the final metrics after the load test finishes, otherwise it would display running metrics every 15 seconds for the duration of the test.</p>
<pre><code>$ cargo run --release --example simple -- --host http://local.dev -v -u1024 -r32 -t10m --status-codes --no-reset-metrics --only-summary
    Finished release [optimized] target(s) in 0.09s
     Running `target/release/examples/simple --host 'http://local.dev' -v -u1024 -r32 -t10m --status-codes --no-reset-metrics --only-summary`
10:55:04 [ INFO] Output verbosity level: INFO
10:55:04 [ INFO] Logfile verbosity level: INFO
10:55:04 [ INFO] Writing to log file: swanling.log
10:55:04 [ INFO] run_time = 600
10:55:04 [ INFO] global host configured: http://local.dev
10:55:04 [ INFO] initializing user states...
10:55:09 [ INFO] launching user 1 from WebsiteUser...
10:55:09 [ INFO] launching user 2 from WebsiteUser...
10:55:09 [ INFO] launching user 3 from WebsiteUser...
</code></pre>
<p>...</p>
<pre><code>10:55:42 [ INFO] launching user 1022 from WebsiteUser...
10:55:42 [ INFO] launching user 1023 from WebsiteUser...
10:55:42 [ INFO] launching user 1024 from WebsiteUser...
10:55:42 [ INFO] launched 1024 users...
All 1024 users hatched.

11:05:09 [ INFO] stopping after 600 seconds...
11:05:09 [ INFO] waiting for users to exit
11:05:09 [ INFO] exiting user 879 from WebsiteUser...
11:05:09 [ INFO] exiting user 41 from WebsiteUser...
11:05:09 [ INFO] exiting user 438 from WebsiteUser...
</code></pre>
<p>...</p>
<pre><code>11:05:10 [ INFO] exiting user 268 from WebsiteUser...
11:05:10 [ INFO] exiting user 864 from WebsiteUser...
11:05:10 [ INFO] exiting user 55 from WebsiteUser...
11:05:11 [ INFO] printing metrics after 601 seconds...

=== PER TASK METRICS ===
------------------------------------------------------------------------------
 Name                    | # times run    | # fails        | task/s | fail/s
 -----------------------------------------------------------------------------
 1: WebsiteUser          |
   1:                    | 1,024          | 0 (0%)         | 1.707  | 0.000
   2:                    | 28,746         | 0 (0%)         | 47.91  | 0.000
   3:                    | 28,748         | 0 (0%)         | 47.91  | 0.000
 ------------------------+----------------+----------------+--------+---------
 Aggregated              | 58,518         | 0 (0%)         | 97.53  | 0.000
-------------------------------------------------------------------------------
 Name                    | Avg (ms)   | Min        | Max        | Median
 -----------------------------------------------------------------------------
 1: WebsiteUser          |
   1:                    | 5.995      | 5          | 37         | 6
   2:                    | 0.428      | 0          | 17         | 0
   3:                    | 0.360      | 0          | 37         | 0
 ------------------------+------------+------------+------------+-------------
 Aggregated              | 0.492      | 5          | 37         | 5

=== PER REQUEST METRICS ===
------------------------------------------------------------------------------
 Name                    | # reqs         | # fails        | req/s  | fail/s
 -----------------------------------------------------------------------------
 GET /                   | 28,746         | 0 (0%)         | 47.91  | 0.000
 GET /about/             | 28,748         | 0 (0%)         | 47.91  | 0.000
 POST /login             | 1,024          | 0 (0%)         | 1.707  | 0.000
 ------------------------+----------------+----------------+--------+---------
 Aggregated              | 58,518         | 29,772 (50.9%) | 97.53  | 49.62
-------------------------------------------------------------------------------
 Name                    | Avg (ms)   | Min        | Max        | Median
 -----------------------------------------------------------------------------
 GET /                   | 0.412      | 0          | 17         | 0
 GET /about/             | 0.348      | 0          | 37         | 0
 POST /login             | 5.979      | 5          | 37         | 6
 ------------------------+------------+------------+------------+-------------
 Aggregated              | 0.478      | 5          | 37         | 5
-------------------------------------------------------------------------------
 Slowest page load within specified percentile of requests (in ms):
 ------------------------------------------------------------------------------
 Name                    | 50%    | 75%    | 98%    | 99%    | 99.9%  | 99.99%
 -----------------------------------------------------------------------------
 GET /                   | 0      | 1      | 3      | 4      | 5      | 5
 GET /about/             | 0      | 0      | 3      | 3      | 5      | 5
 POST /login             | 6      | 6      | 7      | 7      | 28     | 28
 ------------------------+--------+--------+--------+--------+--------+-------
 Aggregated              | 5      | 5      | 5      | 6      | 7      | 17
-------------------------------------------------------------------------------
 Name                    | Status codes
 -----------------------------------------------------------------------------
 GET /                   | 28,746 [200]
 GET /about/             | 28,748 [200]
 POST /login             | 1,024 [200]
-------------------------------------------------------------------------------
 Aggregated              | 58,518 [200]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scheduling-swanlingtasksets"><a class="header" href="#scheduling-swanlingtasksets">Scheduling SwanlingTaskSets</a></h1>
<p>When starting a load test, Swanling assigns one <code>SwanlingTaskSet</code> to each <code>SwanlingUser</code> thread. By default, it assigns <code>SwanlingTaskSet</code>s (and then <code>SwanlingTask</code>s within the task set) in a round robin order. As new <code>SwanlingUser</code> threads are launched, the first will be assigned the first defined <code>SwanlingTaskSet</code>, the next will be assigned the next defined <code>SwanlingTaskSet</code>, and so on, looping through all available <code>SwanlingTaskSet</code>s. Weighting is respected during this process, so if one <code>SwanlingTaskSet</code> is weighted heavier than others, that <code>SwanlingTaskSet</code> will get assigned to <code>SwanlingUser</code>s more at the end of the launching process.</p>
<p>The <code>SwanlingScheduler</code> can be configured to instead launch <code>SwanlingTaskSet</code>s and <code>SwanlingTask</code>s in a <code>Serial</code> or a <code>Random order</code>. When configured to allocate in a <code>Serial</code> order, <code>SwanlingTaskSet</code>s and <code>SwanlingTask</code>s are launched in the extact order they are defined in the load test (see below for more detail on how this works). When configured to allocate in a <code>Random</code> order, running the same load test multiple times can lead to different amounts of load being generated.</p>
<p>Prior to Swanling <code>0.10.6</code> <code>SwanlingTaskSet</code>s were allocated in a serial order. Prior to Swanling <code>0.11.1</code> <code>SwanlingTask</code>s were allocated in a serial order. To restore the old behavior, you can use the <code>SwanlingAttack::set_scheduler()</code> method as follows:</p>
<pre><pre class="playground"><code class="language-rust edition2018">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    SwanlingAttack::initialize()?
        .set_scheduler(SwanlingScheduler::Serial)
<span class="boring">}
</span></code></pre></pre>
<p>To instead randomize the order that <code>SwanlingTaskSet</code>s and <code>SwanlingTask</code>s are allocated, you can instead configure as follows:</p>
<pre><pre class="playground"><code class="language-rust edition2018">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    SwanlingAttack::initialize()?
        .set_scheduler(SwanlingScheduler::Random)
<span class="boring">}
</span></code></pre></pre>
<p>The following configuration is possible but superfluous because it is the scheduling default, and is therefor how Swanling behaves even if the <code>.set_scheduler()</code> method is not called at all:</p>
<pre><pre class="playground"><code class="language-rust edition2018">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    SwanlingAttack::initialize()?
        .set_scheduler(SwanlingScheduler::RoundRobin)
<span class="boring">}
</span></code></pre></pre>
<h3 id="scheduling-example"><a class="header" href="#scheduling-example">Scheduling Example</a></h3>
<p>The following simple example helps illustrate how the different schedulers work.</p>
<pre><pre class="playground"><code class="language-rust edition2018">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    SwanlingAttack::initialize()?
        .register_taskset(taskset!(&quot;TaskSet1&quot;)
            .register_task(task!(task1).set_weight(2)?)
            .register_task(task!(task2))
            .set_weight(2)?
        )
        .register_taskset(taskset!(&quot;TaskSet2&quot;)
            .register_task(task!(task1))
            .register_task(task!(task2).set_weight(2)?)
        )
        .execute()?
        .print();

    Ok(())
<span class="boring">}
</span></code></pre></pre>
<h3 id="round-robin"><a class="header" href="#round-robin">Round Robin</a></h3>
<p>This first example assumes the default of <code>.set_scheduler(SwanlingScheduler::RoundRobin)</code>.</p>
<p>If Swanling is told to launch only two users, the first SwanlingUser will run <code>TaskSet1</code> and the second user will run <code>TaskSet2</code>. Even though <code>TaskSet1</code> has a weight of 2 <code>SwanlingUser</code>s are allocated round-robin so with only two users the second instance of <code>TaskSet1</code> is never launched.</p>
<p>The <code>SwanlingUser</code> running <code>TaskSet1</code> will then launch tasks repeatedly in the following order: <code>task1</code>, <code>task2</code>, <code>task1</code>. If it runs through twice, then it runs all of the following tasks in the following order: <code>task1</code>, <code>task2</code>, <code>task1</code>, <code>task1</code>, <code>task2</code>, <code>task1</code>.</p>
<h3 id="serial"><a class="header" href="#serial">Serial</a></h3>
<p>This second example assumes the manual configuration of <code>.set_scheduler(SwanlingScheduler::Serial)</code>.</p>
<p>If Swanling is told to launch only two users, then both <code>SwanlingUser</code>s will launch <code>TaskSet1</code> as it has a weight of 2. <code>TaskSet2</code> will not get assigned to either of the users.</p>
<p>Both <code>SwanlingUser</code>s running <code>TaskSet1</code> will then launch tasks repeatedly in the following order: <code>task1</code>, <code>task1</code>, <code>task2</code>. If it runs through twice, then it runs all of the following tasks in the following order: <code>task1</code>, <code>task1</code>, <code>task2</code>, <code>task1</code>, <code>task1</code>, <code>task2</code>.</p>
<h3 id="random"><a class="header" href="#random">Random</a></h3>
<p>This third example assumes the manual configuration of <code>.set_scheduler(SwanlingScheduler::Random)</code>.</p>
<p>If Swanling is told to launch only two users, the first will be randomly assigned either <code>TaskSet1</code> or <code>TaskSet2</code>. Regardless of which is assigned to the first user, the second will again be randomly assigned either <code>TaskSet1</code> or <code>TaskSet2</code>. If the load test is stopped and run again, there users are randomly re-assigned, there is no consistency between load test runs.</p>
<p>Each <code>SwanlingUser</code> will run tasks in a random order. The random order will be determined at start time and then will run repeatedly in this random order as long as the user runs.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="defaults"><a class="header" href="#defaults">Defaults</a></h1>
<p>All run-time options can be configured with custom defaults. For example, you may want to default to the the host name of your local development environment, only requiring that <code>--host</code> be set when running against a production environment. Assuming your local development environment is at &quot;http://local.dev/&quot; you can do this as follows:</p>
<pre><pre class="playground"><code class="language-rust edition2018">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    SwanlingAttack::initialize()?
        .register_taskset(taskset!(&quot;LoadtestTasks&quot;)
            .register_task(task!(loadtest_index))
        )
        .set_default(SwanlingDefault::Host, &quot;http://local.dev/&quot;)?
        .execute()?
        .print();

    Ok(())
<span class="boring">}
</span></code></pre></pre>
<p>The following defaults can be configured with a <code>&amp;str</code>:</p>
<ul>
<li>host: <code>SwanlingDefault::Host</code></li>
<li>log file name: <code>SwanlingDefault::LogFile</code></li>
<li>html-formatted report file name: <code>SwanlingDefault::ReportFile</code></li>
<li>requests log file name: <code>SwanlingDefault::RequestsFile</code></li>
<li>requests log file format: <code>SwanlingDefault::RequestsFormat</code></li>
<li>debug log file name: <code>SwanlingDefault::DebugFile</code></li>
<li>debug log file format: <code>SwanlingDefault::DebugFormat</code></li>
<li>host to bind telnet Controller to: <code>SwanlingDefault::TelnetHost</code></li>
<li>host to bind WebSocket Controller to: <code>SwanlingDefault::WebSocketHost</code></li>
<li>host to bind Manager to: <code>SwanlingDefault::ManagerBindHost</code></li>
<li>host for Worker to connect to: <code>SwanlingDefault::ManagerHost</code></li>
</ul>
<p>The following defaults can be configured with a <code>usize</code> integer:</p>
<ul>
<li>total users to start: <code>SwanlingDefault::Users</code></li>
<li>users to start per second: <code>SwanlingDefault::HatchRate</code></li>
<li>how often to print running metrics: <code>SwanlingDefault::RunningMetrics</code></li>
<li>number of seconds for test to run: <code>SwanlingDefault::RunTime</code></li>
<li>log level: <code>SwanlingDefault::LogLevel</code></li>
<li>verbosity: <code>SwanlingDefault::Verbose</code></li>
<li>maximum requests per second: <code>SwanlingDefault::ThrottleRequests</code></li>
<li>number of Workers to expect: <code>SwanlingDefault::ExpectWorkers</code></li>
<li>port to bind telnet Controller to: <code>SwanlingDefault::TelnetPort</code></li>
<li>port to bind WebSocket Controller to: <code>SwanlingDefault::WebSocketPort</code></li>
<li>port to bind Manager to: <code>SwanlingDefault::ManagerBindPort</code></li>
<li>port for Worker to connect to: <code>SwanlingDefault::ManagerPort</code></li>
</ul>
<p>The following defaults can be configured with a <code>bool</code>:</p>
<ul>
<li>do not reset metrics after all users start: <code>SwanlingDefault::NoResetMetrics</code></li>
<li>do not track metrics: <code>SwanlingDefault::NoMetrics</code></li>
<li>do not track task metrics: <code>SwanlingDefault::NoTaskMetrics</code></li>
<li>do not start telnet Controller thread: <code>SwanlingDefault::NoTelnet</code></li>
<li>do not start WebSocket Controller thread: <code>SwanlingDefault::NoWebSocket</code></li>
<li>do not autostart load test, wait instead for a Controller to start: <code>SwanlingDefault::NoAutoStart</code></li>
<li>track status codes: <code>SwanlingDefault::StatusCodes</code></li>
<li>follow redirect of base_url: <code>SwanlingDefault::StickyFollow</code></li>
<li>enable Manager mode: <code>SwanlingDefault::Manager</code></li>
<li>ignore load test checksum: <code>SwanlingDefault::NoHashCheck</code></li>
<li>enable Worker mode: <code>SwanlingDefault::Worker</code></li>
</ul>
<p>The following defaults can be configured with a <code>SwanlingCoordinatedOmissionMitigation</code>:</p>
<ul>
<li>default Coordinated Omission Mitigation strategy: <code>SwanlingDefault::CoordinatedOmissionMitigation</code></li>
</ul>
<p>For example, without any run-time options the following load test would automatically run against <code>local.dev</code>, logging metrics to <code>swanling-metrics.log</code> and debug to <code>swanling-debug.log</code>. It will automatically launch 20 users in 4 seconds, and run the load test for 15 minutes. Metrics will be displayed every minute during the test and will include additional status code metrics. The order the defaults are set is not important.</p>
<pre><pre class="playground"><code class="language-rust edition2018">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    SwanlingAttack::initialize()?
        .register_taskset(taskset!(&quot;LoadtestTasks&quot;)
            .register_task(task!(loadtest_index))
        )
        .set_default(SwanlingDefault::Host, &quot;local.dev&quot;)?
        .set_default(SwanlingDefault::RequestsFile, &quot;swanling-requests.log&quot;)?
        .set_default(SwanlingDefault::DebugFile, &quot;swanling-debug.log&quot;)?
        .set_default(SwanlingDefault::Users, 20)?
        .set_default(SwanlingDefault::HatchRate, 4)?
        .set_default(SwanlingDefault::RunTime, 900)?
        .set_default(SwanlingDefault::RunningMetrics, 60)?
        .set_default(SwanlingDefault::StatusCodes, true)?
        .execute()?
        .print();

    Ok(())
<span class="boring">}
</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="controlling-running-swanling-load-test"><a class="header" href="#controlling-running-swanling-load-test">Controlling Running Swanling Load Test</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="throttling-requests"><a class="header" href="#throttling-requests">Throttling Requests</a></h1>
<p>By default, Swanling will generate as much load as it can. If this is not desirable, the throttle allows optionally limiting the maximum number of requests per second made during a load test. This can be helpful to ensure consistency when running a load test from multiple different servers with different available resources.</p>
<p>The throttle is specified as an integer. For example:</p>
<pre><pre class="playground"><code class="language-rust edition2018">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>$ cargo run --example simple -- --host http://local.dev/ -u100 -r20 -v --throttle-requests 5
<span class="boring">}
</span></code></pre></pre>
<p>In this example, Swanling will launch 100 SwanlingUser threads, but the throttle will prevent them from generating a combined total of more than 5 requests per second. The <code>--throttle-requests</code> command line option imposes a maximum number of requests, not a minimum number of requests.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="logging-load-test-errors"><a class="header" href="#logging-load-test-errors">Logging Load Test Errors</a></h1>
<p>Swanling can optionally log details about all load test errors to a file. To enable, add the <code>--error-file=error.log</code> command line option, where <code>error.log</code> is either a relative or absolute path of the log file to create. Any existing file that may already exist will be overwritten.</p>
<p>When operating in Regatta-mode, the <code>--error-file</code> option can only be enabled on the Worker processes, configuring Swanling to spread out the overhead of writing logs.</p>
<p>By default, logs are written in JSON Lines format. For example:</p>
<pre><code class="language-json">{&quot;elapsed&quot;:2239,&quot;error&quot;:&quot;503 Service Unavailable: /comment/reply/8151&quot;,&quot;final_url&quot;:&quot;http://apache/comment/reply/8151&quot;,&quot;method&quot;:&quot;Post&quot;,&quot;name&quot;:&quot;(Auth) comment form&quot;,&quot;redirected&quot;:false,&quot;response_time&quot;:26,&quot;status_code&quot;:503,&quot;url&quot;:&quot;http://apache/comment/reply/8151&quot;,&quot;user&quot;:1}
{&quot;elapsed&quot;:2261,&quot;error&quot;:&quot;503 Service Unavailable: /node/9577&quot;,&quot;final_url&quot;:&quot;http://apache/node/9577&quot;,&quot;method&quot;:&quot;Get&quot;,&quot;name&quot;:&quot;(Anon) node page&quot;,&quot;redirected&quot;:false,&quot;response_time&quot;:143,&quot;status_code&quot;:503,&quot;url&quot;:&quot;http://apache/node/9577&quot;,&quot;user&quot;:2}
{&quot;elapsed&quot;:2267,&quot;error&quot;:&quot;503 Service Unavailable: /&quot;,&quot;final_url&quot;:&quot;http://apache/&quot;,&quot;method&quot;:&quot;Get&quot;,&quot;name&quot;:&quot;(Auth) front page&quot;,&quot;redirected&quot;:false,&quot;response_time&quot;:138,&quot;status_code&quot;:503,&quot;url&quot;:&quot;http://apache/&quot;,&quot;user&quot;:1}
{&quot;elapsed&quot;:2404,&quot;error&quot;:&quot;503 Service Unavailable: /user/4375&quot;,&quot;final_url&quot;:&quot;http://apache/user/4375&quot;,&quot;method&quot;:&quot;Get&quot;,&quot;name&quot;:&quot;(Anon) user page&quot;,&quot;redirected&quot;:false,&quot;response_time&quot;:5,&quot;status_code&quot;:503,&quot;url&quot;:&quot;http://apache/user/4375&quot;,&quot;user&quot;:2}
</code></pre>
<p>Logs include the entire [<code>SwanlingErrorMetric</code>] object as defined in <code>src/swanling.rs</code>, which are created when requests result in an error.</p>
<p>By default Swanling logs errors in JSON Lines format. The <code>--errors-format</code> option can be used to log in <code>csv</code>, <code>json</code> or <code>raw</code> format. The <code>raw</code> format is Rust's debug output of the entire [<code>SwanlingErrorMetric</code>] object.</p>
<p>For example, <code>csv</code> output of similar errors as those logged above would like like:</p>
<pre><code class="language-csv">elapsed,method,name,url,final_url,redirected,response_time,status_code,user,error
6250,GET,&quot;(Auth) node page&quot;,&quot;http://apache/node/3781&quot;,&quot;http://apache/node/3781&quot;,false,5,503,1,&quot;503 Service Unavailable: /node/3781&quot;
6256,GET,&quot;(Auth) front page&quot;,&quot;http://apache/&quot;,&quot;http://apache/&quot;,false,5,503,1,&quot;503 Service Unavailable: /&quot;
6262,GET,&quot;(Auth) node page&quot;,&quot;http://apache/node/5452&quot;,&quot;http://apache/node/5452&quot;,false,8,503,1,&quot;503 Service Unavailable: /node/5452&quot;
6265,GET,&quot;(Anon) node page&quot;,&quot;http://apache/node/1819&quot;,&quot;http://apache/node/1819&quot;,false,5,503,0,&quot;503 Service Unavailable: /node/1819&quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="logging-load-test-requests"><a class="header" href="#logging-load-test-requests">Logging Load Test Requests</a></h1>
<p>Swanling can optionally log details about all load test requests to a file. To enable, add the <code>--request-log=request.log</code> command line option, where <code>request.log</code> is either a relative or absolute path of the log file to create. Any existing file that may already exist will be overwritten.</p>
<p>When operating in Regatta-mode, the <code>--request-log</code> option can only be enabled on the Worker processes, configuring Swanling to spread out the overhead of writing logs.</p>
<p>By default, logs are written in JSON Lines format. For example:</p>
<pre><code class="language-json">{&quot;coordinated_omission_elapsed&quot;:0,&quot;elapsed&quot;:23189,&quot;error&quot;:&quot;&quot;,&quot;final_url&quot;:&quot;http://apache/misc/drupal.js?q9apdy&quot;,&quot;method&quot;:&quot;Get&quot;,&quot;name&quot;:&quot;static asset&quot;,&quot;redirected&quot;:false,&quot;response_time&quot;:8,&quot;status_code&quot;:200,&quot;success&quot;:true,&quot;update&quot;:false,&quot;url&quot;:&quot;http://apache/misc/drupal.js?q9apdy&quot;,&quot;user&quot;:5,&quot;user_cadence&quot;:0}
{&quot;coordinated_omission_elapsed&quot;:0,&quot;elapsed&quot;:23192,&quot;error&quot;:&quot;&quot;,&quot;final_url&quot;:&quot;http://apache/misc/jquery.once.js?v=1.2&quot;,&quot;method&quot;:&quot;Get&quot;,&quot;name&quot;:&quot;static asset&quot;,&quot;redirected&quot;:false,&quot;response_time&quot;:6,&quot;status_code&quot;:200,&quot;success&quot;:true,&quot;update&quot;:false,&quot;url&quot;:&quot;http://apache/misc/jquery.once.js?v=1.2&quot;,&quot;user&quot;:6,&quot;user_cadence&quot;:0}
{&quot;coordinated_omission_elapsed&quot;:0,&quot;elapsed&quot;:23181,&quot;error&quot;:&quot;&quot;,&quot;final_url&quot;:&quot;http://apache/misc/jquery-extend-3.4.0.js?v=1.4.4&quot;,&quot;method&quot;:&quot;Get&quot;,&quot;name&quot;:&quot;static asset&quot;,&quot;redirected&quot;:false,&quot;response_time&quot;:16,&quot;status_code&quot;:200,&quot;success&quot;:true,&quot;update&quot;:false,&quot;url&quot;:&quot;http://apache/misc/jquery-extend-3.4.0.js?v=1.4.4&quot;,&quot;user&quot;:1,&quot;user_cadence&quot;:0}
</code></pre>
<p>Logs include the entire [<code>SwanlingRequestMetric</code>] object as defined in <code>src/swanling.rs</code>, which are created on all requests.</p>
<p>In the first line of the above example, <code>SwanlingUser</code> thread 7 made a successful <code>GET</code> request for <code>/misc/feed.png</code>, which takes 4 milliseconds. The second line is <code>SwanlingUser</code> thread 2 making a successful <code>GET</code> request for <code>/user/4816</code>, which takes 28 milliseconds.</p>
<p>By default Swanling logs requests in JSON Lines format. The <code>--request-format</code> option can be used to log in <code>csv</code>, <code>json</code> or <code>raw</code> format. The <code>raw</code> format is Rust's debug output of the entire [<code>SwanlingRequestMetric</code>] object.</p>
<p>For example, <code>csv</code> output of similar requests as those logged above would like like:</p>
<pre><code class="language-csv">elapsed,method,name,url,final_url,redirected,response_time,status_code,success,update,user,error,coordinated_omission_elapsed,user_cadence
22143,GET,&quot;(Anon) user page&quot;,&quot;http://apache/user/4&quot;,&quot;http://apache/user/4&quot;,false,25,200,true,false,3,,0,0
22153,GET,&quot;static asset&quot;,&quot;http://apache/misc/jquery-extend-3.4.0.js?v=1.4.4&quot;,&quot;http://apache/misc/jquery-extend-3.4.0.js?v=1.4.4&quot;,false,16,200,true,false,6,,0,0
22165,GET,&quot;static asset&quot;,&quot;http://apache/misc/jquery.js?v=1.4.4&quot;,&quot;http://apache/misc/jquery.js?v=1.4.4&quot;,false,3,200,true,false,0,,0,0
22165,GET,&quot;static asset&quot;,&quot;http://apache/misc/feed.png&quot;,&quot;http://apache/misc/feed.png&quot;,false,4,200,true,false,1,,0,0
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="logging-load-test-tasks"><a class="header" href="#logging-load-test-tasks">Logging Load Test Tasks</a></h1>
<p>Swanling can optionally log details about all load test tasks to a file. To enable, add the <code>--task-log=task.log</code> command line option, where <code>task.log</code> is either a relative or absolute path of the log file to create. Any existing file that may already exist will be overwritten.</p>
<p>When operating in Regatta-mode, the <code>--task-log</code> option can only be enabled on the Worker processes, configuring Swanling to spread out the overhead of writing logs.</p>
<p>By default, logs are written in JSON Lines format. For example:</p>
<pre><code class="language-json">{&quot;elapsed&quot;:22060,&quot;name&quot;:&quot;(Anon) front page&quot;,&quot;run_time&quot;:97,&quot;success&quot;:true,&quot;task_index&quot;:0,&quot;taskset_index&quot;:0,&quot;user&quot;:0}
{&quot;elapsed&quot;:22118,&quot;name&quot;:&quot;(Anon) node page&quot;,&quot;run_time&quot;:41,&quot;success&quot;:true,&quot;task_index&quot;:1,&quot;taskset_index&quot;:0,&quot;user&quot;:5}
{&quot;elapsed&quot;:22157,&quot;name&quot;:&quot;(Anon) node page&quot;,&quot;run_time&quot;:6,&quot;success&quot;:true,&quot;task_index&quot;:1,&quot;taskset_index&quot;:0,&quot;user&quot;:0}
{&quot;elapsed&quot;:22078,&quot;name&quot;:&quot;(Auth) front page&quot;,&quot;run_time&quot;:109,&quot;success&quot;:true,&quot;task_index&quot;:1,&quot;taskset_index&quot;:1,&quot;user&quot;:6}
{&quot;elapsed&quot;:22157,&quot;name&quot;:&quot;(Anon) user page&quot;,&quot;run_time&quot;:35,&quot;success&quot;:true,&quot;task_index&quot;:2,&quot;taskset_index&quot;:0,&quot;user&quot;:4}
</code></pre>
<p>Logs include the entire [<code>SwanlingTaskMetric</code>] object as defined in <code>src/swanling.rs</code>, which are created each time any task is run.</p>
<p>In the first line of the above example, <code>SwanlingUser</code> thread 0 succesfully ran the <code>(Anon) front page</code> task in 97 milliseconds. In the second line <code>SwanlingUser</code> thread 5 succesfully ran the <code>(Anon) node page</code> task in 41 milliseconds.</p>
<p>By default Swanling logs tass in JSON Lines format. The <code>--task-format</code> option can be used to log in <code>csv</code>, <code>json</code> or <code>raw</code> format. The <code>raw</code> format is Rust's debug output of the entire [<code>SwanlingTaskMetric</code>] object.</p>
<p>For example, <code>csv</code> output of similar tasks as those logged above would like like:</p>
<pre><code class="language-csv">elapsed,taskset_index,task_index,name,run_time,success,user
21936,0,0,&quot;(Anon) front page&quot;,83,true,0
21990,1,3,&quot;(Auth) user page&quot;,34,true,1
21954,0,0,&quot;(Anon) front page&quot;,84,true,5
22009,0,1,&quot;(Anon) node page&quot;,34,true,2
21952,0,0,&quot;(Anon) front page&quot;,95,true,7
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="load-test-debug-logging"><a class="header" href="#load-test-debug-logging">Load Test Debug Logging</a></h1>
<p>Swanling can optionally and efficiently log arbitrary details, and specifics about requests and responses for debug purposes. A central logging thread maintains a buffer to minimize the IO overhead, and controls the writing to ensure that multiple threads don't corrupt each other's messages.</p>
<p>To write to the debug log, you must invoke <code>client.log_debug(tag, Option&lt;request&gt;, Option&lt;headers&gt;, Option&lt;body&gt;)</code> from your load test task functions. The <code>tag</code> field is required and can be any arbitrary string: it can identify where in the load test the log was generated, and/or why debug is being written, and/or other details such as the contents of a form the load test posts. The <code>request</code> field is an optional reference to the <a href="https://docs.rs/swanling/*/swanling/swanling/struct.SwanlingRawRequest"><code>SwanlingRawRequest</code></a> object and provides details such as what URL was requested and if it redirected, how long into the load test the request was made, which SwanlingUser thread made the request, and what status code the server responded with. The <code>headers</code> field is an optional reference to all the HTTP headers returned by the remote server for this request. The <code>body</code> field is an optional reference to the entire web page body returned by the server for this request.</p>
<p>See <code>examples/drupal_loadtest</code> for an example of how you might invoke log_debug from a load test.</p>
<p>Calls to <code>client.set_failure(tag, Option&lt;request&gt;, Option&lt;headers&gt;, Option&lt;body&gt;)</code> can be used to tell Swanling that a request failed even though the server returned a successful status code, and will automatically invoke <code>log_debug()</code> for you. See <code>examples/drupal_loadtest</code> and <code>examples/umami</code> to see how you might use <code>set_failure</code> to generate useful debug logs.</p>
<p>When the load test is run with the <code>--debug-log=foo</code> command line option, where <code>foo</code> is either a relative or an absolute path, Swanling will log all debug generated by calls to <code>client.log_debug()</code> (or to <code>client.set_failure()</code>) to this file. If the file already exists it will be overwritten. The following is an example debug log file entry:</p>
<pre><code class="language-json">{&quot;body&quot;:&quot;&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;503 Backend fetch failed&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;h1&gt;Error 503 Backend fetch failed&lt;/h1&gt;\n    &lt;p&gt;Backend fetch failed&lt;/p&gt;\n    &lt;h3&gt;Guru Meditation:&lt;/h3&gt;\n    &lt;p&gt;XID: 923425&lt;/p&gt;\n    &lt;hr&gt;\n    &lt;p&gt;Varnish cache server&lt;/p&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n&quot;,&quot;header&quot;:&quot;{\&quot;date\&quot;: \&quot;Wed, 01 Jul 2020 10:27:31 GMT\&quot;, \&quot;server\&quot;: \&quot;Varnish\&quot;, \&quot;content-type\&quot;: \&quot;text/html; charset=utf-8\&quot;, \&quot;retry-after\&quot;: \&quot;5\&quot;, \&quot;x-varnish\&quot;: \&quot;923424\&quot;, \&quot;age\&quot;: \&quot;0\&quot;, \&quot;via\&quot;: \&quot;1.1 varnish (Varnish/6.1)\&quot;, \&quot;x-varnish-cache\&quot;: \&quot;MISS\&quot;, \&quot;x-varnish-cookie\&quot;: \&quot;SESSd7e04cba6a8ba148c966860632ef3636=hejsW1mQnnsHlua0AicCjEpUjnCRTkOLubwL33UJXRU\&quot;, \&quot;content-length\&quot;: \&quot;283\&quot;, \&quot;connection\&quot;: \&quot;keep-alive\&quot;}&quot;,&quot;request&quot;:{&quot;elapsed&quot;:4192,&quot;final_url&quot;:&quot;http://local.dev/node/3247&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;name&quot;:&quot;(Auth) comment form&quot;,&quot;redirected&quot;:false,&quot;response_time&quot;:8,&quot;status_code&quot;:503,&quot;success&quot;:false,&quot;update&quot;:false,&quot;url&quot;:&quot;http://local.dev/node/3247&quot;,&quot;user&quot;:4},&quot;tag&quot;:&quot;post_comment: no form_build_id found on node/3247&quot;}
</code></pre>
<p>If <code>--debug-log=foo</code> is not specified at run time, nothing will be logged and there is no measurable overhead in your load test.</p>
<p>By default Swanling writes debug logs in JSON Lines format. The <code>--debug-format</code> option can be used to log in <code>json</code> or <code>raw</code> format. The <code>raw</code> format is Rust's debug output of the <code>SwanlingDebug</code> object.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="coordinated-omission-mitigation"><a class="header" href="#coordinated-omission-mitigation">Coordinated Omission Mitigation</a></h1>
<p>https://www.scylladb.com/2021/04/22/on-coordinated-omission/</p>
<p>THIS IS AN EXPERIMENTAL FEATURE THAT IS DISABLED BY DEFAULT. The following documentation is a work in progress, and may currently contain inaccuracies.</p>
<p>When enabled, Swanling attempts to mitigate the loss of metrics data (Coordinated Omission) caused by an abnormally lengthy response to a request.</p>
<h2 id="definition"><a class="header" href="#definition">Definition</a></h2>
<p>To understand Coordinated Omission and how Swanling attempts to mitigate it, it's necessary to understand how Swanling is scheduling requests. Swanling launches one thread per <code>SwanlingUser</code>. Each <code>SwanlingUser</code> is assigned a single <code>SwanlingTaskSet</code>. Each of these <code>SwanlingUser</code> threads then loop repeatedly through all of the <code>SwanlingTasks</code> defined in the assigned <code>SwanlingTaskSet</code>, each of which can involve any number of individual requests. However, at any given time, each <code>SwanlingUser</code> is only making a single request and then asynchronously waiting for the response.</p>
<p>If something causes the response to a request to take abnormally long, raw Swanling metrics only see this slowdown as affecting a specific request (or one request per <code>SwanlingUser</code>). The slowdown can be caused by a variety of issues, such as a resource bottleneck (on the Swanling client or the web server), garbage collection, a cache stampede, or even a network issue. A real user loading the same web page would see a much larger effect, as all requests to the affected server would stall. Even static assets such as images and scripts hosted on a reliable and fast CDN can be affected, as the web browser won't know to load them until it first loads the HTML from the affected web server. Because Swanling is only making one request at a time per <code>SwanlingUser</code>, it may only see one or very few slow requests and then all other requests resume at normal speed. This results in a bias in the metrics to &quot;ignore&quot; or &quot;hide&quot; the true effect of a slowdown, commonly referred to as Coordinated Omission.</p>
<h2 id="mitigation"><a class="header" href="#mitigation">Mitigation</a></h2>
<p>Swanling attempts to mitigate Coordinated Omission by back-filling the metrics with the statistically expected requests. To do this, it tracks the normal &quot;cadence&quot; of each <code>SwanlingUser</code>, timing how long it takes to loop through all <code>SwanlingTasks</code> in the assigned <code>SwanlingTaskSet</code>. By default, Swanling will trigger Coordinated Omission Mitigation if the time to loop through a <code>SwanlingTaskSet</code> takes more than twice as long as the average time of all previous loops. In this case, on the next loop through the <code>SwanlingTaskSet</code> when tracking the actual metrics for each subsequent request in all <code>SwanlingTasks</code> it will also add in statistically generated &quot;requests&quot; with a <code>response_time</code> starting at the unexpectedly long request time, then again with that <code>response_time</code> minus the normal &quot;cadence&quot;, continuing to generate a metric then subtract the normal &quot;cadence&quot; until arriving at the expected <code>response_time</code>. In this way, Swanling is able to estimate the actual effect of a slowdown.</p>
<p>When Swanling detects an abnormally slow request (one in which the individual request takes longer than the normal <code>user_cadence</code>), it will generate an INFO level message (which will be visible if Swanling was started with the <code>-v</code> run time flag, or written to the log if started with the <code>-g</code> run time flag and <code>--swanling-log</code> is configured). For example:</p>
<pre><code>13:10:30 [INFO] 11.401s into swanling attack: &quot;GET http://apache/node/1557&quot; [200] took abnormally long (1814 ms), task name: &quot;(Anon) node page&quot;
13:10:30 [INFO] 11.450s into swanling attack: &quot;GET http://apache/node/5016&quot; [200] took abnormally long (1769 ms), task name: &quot;(Anon) node page&quot;
</code></pre>
<p>If the <code>--request-log</code> is enabled, you can get more details, in this case by looking for elapsed times matching the above messages, specifically 1814 and 1769 respectively:</p>
<pre><code>{&quot;coordinated_omission_elapsed&quot;:0,&quot;elapsed&quot;:11401,&quot;error&quot;:&quot;&quot;,&quot;final_url&quot;:&quot;http://apache/node/1557&quot;,&quot;method&quot;:&quot;Get&quot;,&quot;name&quot;:&quot;(Anon) node page&quot;,&quot;redirected&quot;:false,&quot;response_time&quot;:1814,&quot;status_code&quot;:200,&quot;success&quot;:true,&quot;update&quot;:false,&quot;url&quot;:&quot;http://apache/node/1557&quot;,&quot;user&quot;:2,&quot;user_cadence&quot;:1727}
{&quot;coordinated_omission_elapsed&quot;:0,&quot;elapsed&quot;:11450,&quot;error&quot;:&quot;&quot;,&quot;final_url&quot;:&quot;http://apache/node/5016&quot;,&quot;method&quot;:&quot;Get&quot;,&quot;name&quot;:&quot;(Anon) node page&quot;,&quot;redirected&quot;:false,&quot;response_time&quot;:1769,&quot;status_code&quot;:200,&quot;success&quot;:true,&quot;update&quot;:false,&quot;url&quot;:&quot;http://apache/node/5016&quot;,&quot;user&quot;:0,&quot;user_cadence&quot;:1422}
</code></pre>
<p>In the requests file, you can see that two different user threads triggered Coordinated Omission Mitigation, specifically threads 2 and 0. Both <code>SwanlingUser</code> threads were loading the same <code>SwanlingTask</code> as due to task weighting this is the task loaded the most frequently. Both <code>SwanlingUser</code> threads loop through all <code>SwanlingTasks</code> in a similar amount of time: thread 2 takes on average 1.727 seconds, thread 0 takes on average 1.422 seconds.</p>
<p>Also if the <code>--request-log</code> is enabled, requests back-filled by Coordinated Omission Mitigation show up in the generated log file, even though they were not actually sent to the server. Normal requests not generated by Coordinated Omission Mitigation have a <code>coordinated_omission_elapsed</code> of 0.</p>
<p>Coordinated Omission Mitigation is disabled by default. This experimental feature can be enabled by enabling the <code>--co-mitigation</code> run time option when starting Swanling. It can be configured to use the <code>average</code>, <code>minimum</code>, or <code>maximum</code> <code>GoouseUser</code> cadence when backfilling statistics.</p>
<h2 id="metrics"><a class="header" href="#metrics">Metrics</a></h2>
<p>When Coordinated Omission Mitigation kicks in, Swanling tracks both the &quot;raw&quot; metrics and the &quot;adjusted&quot; metrics. It shows both together when displaying metrics, first the &quot;raw&quot; (actually seen) metrics, followed by the &quot;adjusted&quot; metrics. As the minimum response time is never changed by Coordinated Omission Mitigation, this column is replacd with the &quot;standard deviation&quot; between the average &quot;raw&quot; response time, and the average &quot;adjusted&quot; response time.</p>
<p>The following example was &quot;contrived&quot;. The <code>drupal_loadtest</code> example was run for 15 seconds, and after 10 seconds the upstream Apache server was manually &quot;paused&quot; for 3 seconds, forcing some abnormally slow queries. (More specifically, the apache web server was started by running <code>. /etc/apache2/envvars &amp;&amp; /usr/sbin/apache2 -DFOREGROUND</code>, it was &quot;paused&quot; by pressing <code>ctrl-z</code>, and it was resumed three seconds later by typing <code>fg</code>.) In the &quot;PER REQUEST METRICS&quot; Swanling shows first the &quot;raw&quot; metrics&quot;, followed by the &quot;adjusted&quot; metrics:</p>
<pre><code> ------------------------------------------------------------------------------
 Name                     |    Avg (ms) |        Min |         Max |     Median
 ------------------------------------------------------------------------------
 GET (Anon) front page    |       11.73 |          3 |          81 |         12
 GET (Anon) node page     |       81.76 |          5 |       3,390 |         37
 GET (Anon) user page     |       27.53 |         16 |          94 |         26
 GET (Auth) comment form  |       35.27 |         24 |          50 |         35
 GET (Auth) front page    |       30.68 |         20 |         111 |         26
 GET (Auth) node page     |       97.79 |         23 |       3,326 |         35
 GET (Auth) user page     |       25.20 |         21 |          30 |         25
 GET static asset         |        9.27 |          2 |          98 |          6
 POST (Auth) comment form |       52.47 |         43 |          59 |         52
 -------------------------+-------------+------------+-------------+-----------
 Aggregated               |       17.04 |          2 |       3,390 |          8
 ------------------------------------------------------------------------------
 Adjusted for Coordinated Omission:
 ------------------------------------------------------------------------------
 Name                     |    Avg (ms) |    Std Dev |         Max |     Median
 ------------------------------------------------------------------------------
 GET (Anon) front page    |      419.82 |     288.56 |       3,153 |         14
 GET (Anon) node page     |      464.72 |     270.80 |       3,390 |         40
 GET (Anon) user page     |      420.48 |     277.86 |       3,133 |         27
 GET (Auth) comment form  |      503.38 |     331.01 |       2,951 |         37
 GET (Auth) front page    |      489.99 |     324.78 |       2,960 |         33
 GET (Auth) node page     |      530.29 |     305.82 |       3,326 |         37
 GET (Auth) user page     |      500.67 |     336.21 |       2,959 |         27
 GET static asset         |      427.70 |     295.87 |       3,154 |          9
 POST (Auth) comment form |      512.14 |     325.04 |       2,932 |         55
 -------------------------+-------------+------------+-------------+-----------
 Aggregated               |      432.98 |     294.11 |       3,390 |         14
</code></pre>
<p>From these two tables, it is clear that there was a statistically significant event affecting the load testing metrics. In particular, note that the standard deviation between the &quot;raw&quot; average and the &quot;adjusted&quot; average is considerably larger than the &quot;raw&quot; average, calling into questing whether or not your load test was &quot;valid&quot;. (The answer to that question depends very much on your specific goals and load test.)</p>
<p>Swanling also shows multiple percentile graphs, again showing first the &quot;raw&quot; metrics followed by the &quot;adjusted&quot; metrics. The &quot;raw&quot; graph would suggest that less than 1% of the requests for the <code>GET (Anon) node page</code> were slow, and less than 0.1% of the requests for the <code>GET (Auth) node page</code> were slow. However, through Coordinated Omission Mitigation we can see that statistically this would have actually affected all requests, and for authenticated users the impact is visible on &gt;25% of the requests.</p>
<pre><code> ------------------------------------------------------------------------------
 Slowest page load within specified percentile of requests (in ms):
 ------------------------------------------------------------------------------
 Name                     |    50% |    75% |    98% |    99% |  99.9% | 99.99%
 ------------------------------------------------------------------------------
 GET (Anon) front page    |     12 |     15 |     25 |     27 |     81 |     81
 GET (Anon) node page     |     37 |     43 |     60 |  3,000 |  3,000 |  3,000
 GET (Anon) user page     |     26 |     28 |     34 |     93 |     94 |     94
 GET (Auth) comment form  |     35 |     37 |     50 |     50 |     50 |     50
 GET (Auth) front page    |     26 |     34 |     45 |     88 |    110 |    110
 GET (Auth) node page     |     35 |     38 |     58 |     58 |  3,000 |  3,000
 GET (Auth) user page     |     25 |     27 |     30 |     30 |     30 |     30
 GET static asset         |      6 |     14 |     21 |     22 |     81 |     98
 POST (Auth) comment form |     52 |     55 |     59 |     59 |     59 |     59
 -------------------------+--------+--------+--------+--------+--------+-------
 Aggregated               |      8 |     16 |     47 |     53 |  3,000 |  3,000
 ------------------------------------------------------------------------------
 Adjusted for Coordinated Omission:
 ------------------------------------------------------------------------------
 Name                     |    50% |    75% |    98% |    99% |  99.9% | 99.99%
 ------------------------------------------------------------------------------
 GET (Anon) front page    |     14 |     21 |  3,000 |  3,000 |  3,000 |  3,000
 GET (Anon) node page     |     40 |     55 |  3,000 |  3,000 |  3,000 |  3,000
 GET (Anon) user page     |     27 |     32 |  3,000 |  3,000 |  3,000 |  3,000
 GET (Auth) comment form  |     37 |    400 |  2,951 |  2,951 |  2,951 |  2,951
 GET (Auth) front page    |     33 |    410 |  2,960 |  2,960 |  2,960 |  2,960
 GET (Auth) node page     |     37 |    410 |  3,000 |  3,000 |  3,000 |  3,000
 GET (Auth) user page     |     27 |    420 |  2,959 |  2,959 |  2,959 |  2,959
 GET static asset         |      9 |     20 |  3,000 |  3,000 |  3,000 |  3,000
 POST (Auth) comment form |     55 |    390 |  2,932 |  2,932 |  2,932 |  2,932
 -------------------------+--------+--------+--------+--------+--------+-------
 Aggregated               |     14 |     42 |  3,000 |  3,000 |  3,000 |  3,000
</code></pre>
<p>The Coordinated Omission metrics will also show up in the HTML report generated when Swanling is started with the <code>--report-file</code> run-time option. If Coordinated Omission mitigation kicked in, the HTML report will include both the &quot;raw&quot; metrics and the &quot;adjusted&quot; metrics.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="distributed-load-test"><a class="header" href="#distributed-load-test">Distributed Load Test</a></h1>
<p>Swanling also supports distributed load testing. A Regatta is one Swanling process running in Manager mode, and 1 or more Swanling processes running in Worker mode. The Manager coordinates starting and stopping the Workers, and collects aggregated metrics. Regatta support is a cargo feature that must be enabled at compile-time as documented below. To launch a Regatta, you must copy your load test application to all servers from which you wish to generate load.</p>
<p>It is strongly recommended that the same load test application be copied to all servers involved in a Regatta. By default, Swanling will verify that the load test is identical by comparing a hash of all load test rules. Telling it to skip this check can cause the load test to panic (for example, if a Worker defines a different number of tasks or task sets than the Manager).</p>
<h2 id="regatta-compile-time-feature"><a class="header" href="#regatta-compile-time-feature">Regatta Compile-time Feature</a></h2>
<p>Regatta support is a compile-time Cargo feature that must be enabled. Swanling uses the <a href="https://docs.rs/nng/"><code>nng</code></a> library to manage network connections, and compiling <code>nng</code> requires that <code>cmake</code> be available.</p>
<p>The <code>gaggle</code> feature can be enabled from the command line by adding <code>--features gaggle</code> to your cargo command.</p>
<p>When writing load test applications, you can default to compiling in the Regatta feature in the <code>dependencies</code> section of your <code>Cargo.toml</code>, for example:</p>
<pre><code class="language-toml">[dependencies]
swanling = { version = &quot;^0.12&quot;, features = [&quot;gaggle&quot;] }
</code></pre>
<h2 id="regatta-manager"><a class="header" href="#regatta-manager">Regatta Manager</a></h2>
<p>To launch a Regatta, you first must start a Swanling application in Manager mode. All configuration happens in the Manager. To start, add the <code>--manager</code> flag and the <code>--expect-workers</code> flag, the latter necessary to tell the Manager process how many Worker processes it will be coordinating. For example:</p>
<pre><code>cargo run --features gaggle --example simple -- --manager --expect-workers 2 --host http://local.dev/ -v
</code></pre>
<p>This configures a Swanling Manager to listen on all interfaces on the default port (0.0.0.0:5115) for 2 Swanling Worker processes.</p>
<h2 id="regatta-worker"><a class="header" href="#regatta-worker">Regatta Worker</a></h2>
<p>At this time, a Swanling process can be either a Manager or a Worker, not both. Therefor, it usually makes sense to launch your first Worker on the same server that the Manager is running on. If not otherwise configured, a Swanling Worker will try to connect to the Manager on the localhost. This can be done as follows:</p>
<pre><code>cargo run --features gaggle --example simple -- --worker -v
</code></pre>
<p>In our above example, we expected 2 Workers. The second Swanling process should be started on a different server. This will require telling it the host where the Swanling Manager process is running. For example:</p>
<pre><code>cargo run --example simple -- --worker --manager-host 192.168.1.55 -v
</code></pre>
<p>Once all expected Workers are running, the distributed load test will automatically start. We set the <code>-v</code> flag so Swanling provides verbose output indicating what is happening. In our example, the load test will run until it is canceled. You can cancel the Manager or either of the Worker processes, and the test will stop on all servers.</p>
<h2 id="regatta-run-time-flags"><a class="header" href="#regatta-run-time-flags">Regatta Run-time Flags</a></h2>
<ul>
<li><code>--manager</code>: starts a Swanling process in Manager mode. There currently can only be one Manager per Regatta.</li>
<li><code>--worker</code>: starts a Swanling process in Worker mode. How many Workers are in a given Regatta is defined by the <code>--expect-workers</code> option, documented below.</li>
<li><code>--no-hash-check</code>: tells Swanling to ignore if the load test application doesn't match between Worker(s) and the Manager. This is not recommended, and can cause the application to panic.</li>
</ul>
<p>The <code>--no-metrics</code>, <code>--only-summary</code>, <code>--no-reset-metrics</code>, <code>--status-codes</code>, and <code>--no-hash-check</code> flags must be set on the Manager. Workers inherit these flags from the Manager</p>
<h2 id="regatta-run-time-options"><a class="header" href="#regatta-run-time-options">Regatta Run-time Options</a></h2>
<ul>
<li><code>--manager-bind-host &lt;manager-bind-host&gt;</code>: configures the host that the Manager listens on. By default Swanling will listen on all interfaces, or <code>0.0.0.0</code>.</li>
<li><code>--manager-bind-port &lt;manager-bind-port&gt;</code>: configures the port that the Manager listens on. By default Swanling will listen on port <code>5115</code>.</li>
<li><code>--manager-host &lt;manager-host&gt;</code>: configures the host that the Worker will talk to the Manager on. By default, a Swanling Worker will connect to the localhost, or <code>127.0.0.1</code>. In a distributed load test, this must be set to the IP of the Swanling Manager.</li>
<li><code>--manager-port &lt;manager-port&gt;</code>: configures the port that a Worker will talk to the Manager on. By default, a Swanling Worker will connect to port <code>5115</code>.</li>
</ul>
<p>The <code>--users</code>, <code>--hatch-rate</code>, <code>--host</code>, and <code>--run-time</code> options must be set on the Manager. Workers inherit these options from the Manager.</p>
<p>The <code>--throttle-requests</code> option must be configured on each Worker, and can be set to a different value on each Worker if desired.</p>
<h2 id="technical-details"><a class="header" href="#technical-details">Technical Details</a></h2>
<p>Swanling uses <a href="https://docs.rs/nng/"><code>nng</code></a> to send network messages between the Manager and all Workers. <a href="https://docs.serde.rs/serde/index.html">Serde</a> and <a href="https://github.com/pyfisch/cbor">Serde CBOR</a> are used to serialize messages into <a href="https://tools.ietf.org/html/rfc7049">Concise Binary Object Representation</a>.</p>
<p>Workers initiate all network connections, and push metrics to the Manager process.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rustls"><a class="header" href="#rustls">RustLS</a></h1>
<p>By default Reqwest (and therefore Swanling) uses the system-native transport layer security to make HTTPS requests. This means <code>schannel</code> on Windows, <code>Security-Framework</code> on macOS, and <code>OpenSSL</code> on Linux. If you'd prefer to use a <a href="https://github.com/ctz/rustls">pure Rust TLS implementation</a>, disable default features and enable <code>rustls</code> in <code>Cargo.toml</code> as follows:</p>
<pre><code class="language-toml">[dependencies]
swanling = { version = &quot;^0.12&quot;, default-features = false, features = [&quot;rustls&quot;] }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="developers"><a class="header" href="#developers">Developers</a></h1>
<p><a href="https://docs.rs/swanling/">Developer documentation (external link)</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contributors"><a class="header" href="#contributors">Contributors</a></h1>
<p>Here is a list of the contributors who have helped improve Swanling. Big shout-out to them!</p>
<ul>
<li>Jeremy Andrews</li>
<li>Fabian Franz</li>
<li>Narayan Newton</li>
<li>Begley Brothers Inc</li>
<li>Bernardo Uriarte Blanco</li>
<li>David Laban</li>
<li>jcarres-mdsol</li>
<li>Alexander Liesenfeld</li>
<li>nnewton</li>
<li>Igor Davydenko</li>
<li>Vladislav Chugunov</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
                
    </body>
</html>
